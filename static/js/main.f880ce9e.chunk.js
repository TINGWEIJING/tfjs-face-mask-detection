(this["webpackJsonptfjs-mobilenetv2-od"]=this["webpackJsonptfjs-mobilenetv2-od"]||[]).push([[0],{328:function(e,t,n){},334:function(e,t){},335:function(e,t){},343:function(e,t){},353:function(e,t){},354:function(e,t){},355:function(e,t){},356:function(e,t){},364:function(e,t){},365:function(e,t,n){},370:function(e,t,n){"use strict";n.r(t);var a=n(11),c=n.n(a),r=n(133),i=n.n(r),s=(n(328),n(76)),o=n(12),l=n(4),u=n(5),d=n.n(u),h=n(418),f=n(416),b=n(421),g=n(419),j=n(415),m=n(413),v=n(417),p=n(87),x=n(314),O=n.n(x),w=(n(365),{root:{height:"100vh",width:"100vw",display:"flex",alignItems:"stretch",backgroundColor:"#E6EE9C",flexDirection:"column"},webCamParentPanel:{width:"100%",backgroundColor:"#C5CAE9",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row",margin:0,padding:0,gap:0},webCamPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},settingPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},faceMaskPanel:{display:"flex",backgroundColor:"#BBDEFB",justifyContent:"space-evenly",alignItems:"center",margin:0,padding:0,gap:0},faceMaskContainer:{display:"flex",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0,flexDirection:"column"},webCamStackItem:{position:"absolute",top:0,left:0,marginLeft:"auto"}});function y(){var e=window.visualViewport;return{width:e.width,height:e.height}}var I=function(e,t,n,a,c,r,i){for(var s=[],o=0,l=e.length;o<l&&!(e[o]<t);){var u=[],d=n[0][o][0]*a,h=n[0][o][1]*c,f=n[0][o][2]*a,b=n[0][o][3]*c;u[0]=h,u[1]=d,u[2]=b-h,u[3]=f-d;var g=parseInt(n[0][o][0]*r),j=parseInt(n[0][o][1]*i),m=[g,j,parseInt(n[0][o][2]*r)-g+1,parseInt(n[0][o][3]*i)-j+1];s.push({label:"face",score:e[o],bbox:u,slideBox:m,cropBox:n[0][o],boxInd:o}),o++}return s},C=function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return console.log("enumerateDevices() not supported."),e.abrupt("return",[{deviceName:null,deviceId:null}]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0,a=e.length;n<a;)"videoinput"===e[n].kind&&t.push({deviceName:e[n].label,deviceId:e[n].deviceId}),n++;return t})).catch((function(e){return console.log(e.name+": "+e.message),[{deviceName:null,deviceId:null}]}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var k=n(21),P=[16/9,4/3],S="".concat("/tfjs-face-mask-detection","/test_imgs/mask_01.jpg");var F=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(Array(5).fill(0)),n=Object(a.useState)([]),c=Object(l.a)(n,2),r=c[0],i=c[1],u=Object(a.useState)([]),x=Object(l.a)(u,2),F=x[0],W=x[1],E=Object(a.useState)(null),B=Object(l.a)(E,2),D=B[0],H=B[1],M=Object(a.useState)(null),A=Object(l.a)(M,2),R=A[0],_=A[1],N=Object(a.useState)({}),z=Object(l.a)(N,2),L=z[0],V=z[1],J=Object(a.useState)(!1),T=Object(l.a)(J,2),Q=T[0],q=T[1],G=Object(a.useState)({deviceName:"",deviceId:""}),K=Object(l.a)(G,2),U=K[0],X=K[1],Y=Object(a.useState)([]),Z=Object(l.a)(Y,2),$=Z[0],ee=Z[1],te=function(){var e=Object(a.useState)(y()),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){function e(){c(y())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),ne=te.height,ae=te.width,ce=function(e,t,n,a,c){var r=e*n/100,i=t*a/100,s=i/c[0],o=r*c[0],l=r,u=i;return s>r?u=o:l=s,{webCamPanelWidth:i,webCamPanelHeight:r,expectedWebCamWidth:u,expectedWebCamHeight:l}}(ne,ae,65,70,P),re=ce.webCamPanelWidth,ie=ce.webCamPanelHeight,se=ce.expectedWebCamWidth,oe=ce.expectedWebCamHeight,le=function(e,t,n,a){var c=e/t,r=n/c,i=a,s=n;return r>a?s=a*c:i=r,{expectedImgWidth:s,expectedImgHeight:i}}(void 0!==L.oriImgWidth?L.oriImgWidth:0,void 0!==L.oriImgHeight?L.oriImgHeight:1,re,ie),ue=le.expectedImgWidth,de=le.expectedImgHeight,he=35*ne/100*.5,fe=function(){var e=Object(o.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==D&&D.dispose(),null!==R&&R.dispose(),e.next=4,p.e("tfjs/face_detection/model.json",{onProgress:function(e){}});case 4:return t=e.sent,e.next=7,p.e("tfjs/face_mask_classification/model.json",{onProgress:function(e){}});case 7:return n=e.sent,H(t),_(n),console.log("Model loaded."),e.abrupt("return",[t,n]);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(){var n=Object(o.a)(d.a.mark((function n(a,c){var r,s,o,l,u,h,f,b,g;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=a&&null!=c){n.next=2;break}return n.abrupt("return");case 2:if("undefined"===typeof e.current||null===e.current||4!==e.current.video.readyState){n.next=15;break}s=e.current.video,r=document.getElementById("myCanvas"),e.current.video.width=se,e.current.video.height=oe,r.width=se,r.height=oe,o=oe,l=se,u=720,h=1280,n.next=27;break;case 15:if(Q){n.next=26;break}s=document.getElementById("test_img"),(r=document.getElementById("test_canvas")).width=ue,r.height=de,o=de,l=ue,u=de,h=ue,n.next=27;break;case 26:return n.abrupt("return");case 27:f=r.getContext("2d"),"16px sans-serif",f.font="16px sans-serif",f.textBaseline="top",b=p.a.fromPixels(s),g=p.g((function(){return b.transpose([0,1,2]).expandDims()})),a.executeAsync(g).then((function(e){var n,a,r,s=e[4].arraySync(),d=e[6].dataSync(),g=I(d,.5,s,o,l,u,h),j=Array(5).fill(null),m=Array(5).fill(null);if(g.length>0){for(n=0,a=g.length,r=5,f.clearRect(0,0,oe,se);n<a;){var v=g[n].bbox[0],x=g[n].bbox[1],O=g[n].bbox[2],w=g[n].bbox[3];f.strokeStyle="#00FFFF",f.lineWidth=2,f.strokeRect(v,x,O,w),n<r&&(j[n]=g[n].score),n++}var y=g.map((function(e,t){return e.cropBox})),C=g.map((function(e,t){return e.boxInd})),k=p.g((function(){var e=b.tile([C.length,1,1]).reshape([-1,b.shape[0],b.shape[1],3]);return p.d.cropAndResize(e,y,C,[224,224],"bilinear")})),P=p.g((function(){return c.execute(k).arraySync()}));n=0,a=t.current.length,r=g.length;for(var S=k.arraySync();n<a;){if(n<r){var F=t.current[n];p.a.toPixels(S[n],F),m[n]=P[n][0]}else{t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height)}n++}k.dispose()}else for(f.clearRect(0,0,oe,se),n=0,a=t.current.length;n<a;){t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height),n++}return i(j),W(m),e})).then((function(e){for(var t=0,n=e.length;t<n;)p.b(e[t]),t++})).finally((function(){p.b(b),p.b(g)}));case 34:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return Object(a.useEffect)((function(){p.f().then((function(e){p.c(),console.log("tfjs is ready")})).then(fe)}),[]),Object(a.useEffect)((function(){if(null!==D&&null!==R){if(Q){var e=setInterval(be,100,D,R);return function(){return clearInterval(e)}}console.log("Run on test img"),be(D,R)}}),[R,D,ne,ae,Q,L]),Object(a.useEffect)((function(){if(!Q){var e=new Image;e.src=S,e.onload=function(){V({oriImgHeight:e.naturalHeight,oriImgWidth:e.naturalWidth})}}}),[Q]),Object(a.useEffect)((function(){i(Array(5).fill(null)),W(Array(5).fill(null))}),[5]),Object(a.useEffect)((function(){C().then((function(e){ee(e),e.length>0&&X(e[0])}))}),[Q]),Object(k.jsxs)("div",{className:"App",style:w.root,children:[Object(k.jsxs)("div",{style:Object(s.a)(Object(s.a)({},w.webCamParentPanel),{},{flexBasis:"".concat(65,"%")}),children:[Object(k.jsxs)("div",{style:Object(s.a)(Object(s.a)({},w.webCamPanel),{},{flexBasis:"".concat(70,"%")}),children:[Q&&Object(k.jsxs)("div",{style:{},children:[Object(k.jsx)(O.a,{audio:!1,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{height:oe,width:se}),id:"img",ref:e,height:oe,width:se,screenshotQuality:1,screenshotFormat:"image/jpeg",videoConstraints:{height:720,width:1280,facingMode:"environment"}}),Object(k.jsx)("canvas",{id:"myCanvas",height:oe,width:se,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{zIndex:9999,backgroundColor:"transparent"})})]}),!Q&&Object(k.jsxs)("div",{style:{},children:[Object(k.jsx)("img",{id:"test_img",src:S,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{height:de,width:ue}),height:de,width:ue,alt:""}),Object(k.jsx)("canvas",{id:"test_canvas",height:de,width:ue,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{zIndex:9999,backgroundColor:"transparent"})})]})]}),Object(k.jsx)("div",{style:Object(s.a)(Object(s.a)({},w.settingPanel),{},{flexBasis:"".concat(30,"%")}),children:Object(k.jsxs)(b.a,{children:[Object(k.jsxs)(h.a,{sx:{m:1,minWidth:220},size:"small",children:[Object(k.jsx)(g.a,{id:"demo-simple-select-autowidth-label",children:"Video Input"}),Object(k.jsx)(m.a,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:U.deviceId,onChange:function(e){X({deviceName:e.target.name,deviceId:e.target.value})},autoWidth:!0,label:"Video Input",children:$.length>0?$.map((function(e,t){return Object(k.jsx)(j.a,{value:e.deviceId,children:e.deviceName},t)})):Object(k.jsx)(j.a,{value:"",children:""})})]}),Object(k.jsx)(f.a,{control:Object(k.jsx)(v.a,{checked:Q,onChange:function(e){q(e.target.checked)},inputProps:{"aria-label":"controlled"}}),label:"Webcam",labelPlacement:"start"})]})})]}),Object(k.jsx)("div",{style:Object(s.a)(Object(s.a)({},w.faceMaskPanel),{},{flexBasis:"".concat(35,"%")}),children:t.current.map((function(e,n){var a="",c="",i="";return null!==r[n]&&void 0!==r[n]&&null!==F[n]&&void 0!==F[n]&&(a=F[n]>0?"No Mask":"Mask",c="Face: ".concat(r[n].toFixed(2)),i="Mask: ".concat(F[n].toFixed(2))),Object(k.jsxs)("div",{style:w.faceMaskContainer,children:[Object(k.jsx)("div",{children:a}),Object(k.jsx)("canvas",{ref:function(e){return t.current[n]=e},height:he,width:he,style:{height:he,width:he}}),Object(k.jsx)("div",{children:c}),Object(k.jsx)("div",{children:i})]},n)}))})]})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,422)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(F,{})}),document.getElementById("root")),W()}},[[370,1,2]]]);
//# sourceMappingURL=main.f880ce9e.chunk.js.map