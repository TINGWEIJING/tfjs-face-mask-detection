(this["webpackJsonptfjs-face-mask-detection"]=this["webpackJsonptfjs-face-mask-detection"]||[]).push([[0],{328:function(e,t,n){},334:function(e,t){},335:function(e,t){},343:function(e,t){},353:function(e,t){},354:function(e,t){},355:function(e,t){},356:function(e,t){},364:function(e,t){},365:function(e,t,n){},370:function(e,t,n){"use strict";n.r(t);var a=n(11),c=n.n(a),i=n(133),r=n.n(i),s=(n(328),n(76)),o=n(12),l=n(4),u=n(5),d=n.n(u),h=n(418),f=n(416),b=n(421),g=n(419),j=n(415),m=n(413),v=n(417),p=n(87),x=n(314),O=n.n(x),w=(n(365),{root:{height:"100vh",width:"100vw",display:"flex",alignItems:"stretch",backgroundColor:"#E6EE9C",flexDirection:"column"},webCamParentPanel:{width:"100%",backgroundColor:"#C5CAE9",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row",margin:0,padding:0,gap:0},webCamPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},settingPanel:{display:"flex",height:"100%",backgroundColor:"#FFF59D",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0},faceMaskPanel:{display:"flex",backgroundColor:"#BBDEFB",justifyContent:"space-evenly",alignItems:"center",margin:0,padding:0,gap:0},faceMaskContainer:{display:"flex",justifyContent:"center",alignItems:"center",margin:0,padding:0,gap:0,flexDirection:"column"},webCamStackItem:{position:"absolute",top:0,left:0,marginLeft:"auto"}});function y(){var e=window.visualViewport;return{width:e.width,height:e.height}}var I=function(e,t,n,a,c,i,r){for(var s=[],o=0,l=e.length;o<l&&!(e[o]<t);){var u=[],d=n[0][o][0]*a,h=n[0][o][1]*c,f=n[0][o][2]*a,b=n[0][o][3]*c;u[0]=h,u[1]=d,u[2]=b-h,u[3]=f-d;var g=parseInt(n[0][o][0]*i),j=parseInt(n[0][o][1]*r),m=[g,j,parseInt(n[0][o][2]*i)-g+1,parseInt(n[0][o][3]*r)-j+1];s.push({label:"face",score:e[o],bbox:u,slideBox:m,cropBox:n[0][o],boxInd:o}),o++}return s},C=function(){var e=Object(o.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){e.next=3;break}return console.log("enumerateDevices() not supported."),e.abrupt("return",[{deviceName:null,deviceId:null}]);case 3:return e.next=5,navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=[],n=0,a=e.length;n<a;)"videoinput"===e[n].kind&&t.push({deviceName:e[n].label,deviceId:e[n].deviceId}),n++;return t})).catch((function(e){return console.log(e.name+": "+e.message),[{deviceName:null,deviceId:null}]}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var k=n(19),S=[16/9,4/3],P="".concat("/tfjs-face-mask-detection","/test_imgs/mask_01.jpg");var F=function(){var e=Object(a.useRef)(null),t=Object(a.useRef)(Array(5).fill(0)),n=Object(a.useState)(0),c=Object(l.a)(n,2),i=c[0],r=c[1],u=Object(a.useState)(0),x=Object(l.a)(u,2),F=x[0],W=x[1],E=Object(a.useState)([]),B=Object(l.a)(E,2),D=B[0],M=B[1],H=Object(a.useState)([]),A=Object(l.a)(H,2),R=A[0],_=A[1],N=Object(a.useState)(null),z=Object(l.a)(N,2),L=z[0],V=z[1],J=Object(a.useState)(null),T=Object(l.a)(J,2),Q=T[0],q=T[1],G=Object(a.useState)({}),K=Object(l.a)(G,2),U=K[0],X=K[1],Y=Object(a.useState)(!1),Z=Object(l.a)(Y,2),$=Z[0],ee=Z[1],te=Object(a.useState)({deviceName:"",deviceId:""}),ne=Object(l.a)(te,2),ae=ne[0],ce=ne[1],ie=Object(a.useState)([]),re=Object(l.a)(ie,2),se=re[0],oe=re[1],le=function(){var e=Object(a.useState)(y()),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){function e(){c(y())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),ue=le.height,de=le.width,he=function(e,t,n,a,c){var i=e*n/100,r=t*a/100,s=r/c[0],o=i*c[0],l=i,u=r;return s>i?u=o:l=s,{webCamPanelWidth:r,webCamPanelHeight:i,expectedWebCamWidth:u,expectedWebCamHeight:l}}(ue,de,65,70,S),fe=he.webCamPanelWidth,be=he.webCamPanelHeight,ge=he.expectedWebCamWidth,je=he.expectedWebCamHeight,me=function(e,t,n,a){var c=e/t,i=n/c,r=a,s=n;return i>a?s=a*c:r=i,{expectedImgWidth:s,expectedImgHeight:r}}(void 0!==U.oriImgWidth?U.oriImgWidth:0,void 0!==U.oriImgHeight?U.oriImgHeight:1,fe,be),ve=me.expectedImgWidth,pe=me.expectedImgHeight,xe=35*ue/100*.5,Oe={height:720,width:1280,deviceId:ae.deviceId},we=function(){var e=Object(o.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==L&&L.dispose(),null!==Q&&Q.dispose(),e.next=4,p.e("tfjs/face_detection/model.json",{onProgress:function(e){r(e)}});case 4:return t=e.sent,e.next=7,p.e("tfjs/face_mask_classification/model.json",{onProgress:function(e){W(e)}});case 7:return n=e.sent,V(t),q(n),console.log("Model loaded."),e.abrupt("return",[t,n]);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(){var n=Object(o.a)(d.a.mark((function n(a,c){var i,r,s,o,l,u,h,f,b;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=a&&null!=c){n.next=2;break}return n.abrupt("return");case 2:if("undefined"===typeof e.current||null===e.current||4!==e.current.video.readyState){n.next=15;break}r=e.current.video,i=document.getElementById("myCanvas"),e.current.video.width=ge,e.current.video.height=je,i.width=ge,i.height=je,s=je,o=ge,l=720,u=1280,n.next=27;break;case 15:if($){n.next=26;break}r=document.getElementById("test_img"),(i=document.getElementById("test_canvas")).width=ve,i.height=pe,s=pe,o=ve,l=pe,u=ve,n.next=27;break;case 26:return n.abrupt("return");case 27:h=i.getContext("2d"),"16px sans-serif",h.font="16px sans-serif",h.textBaseline="top",f=p.a.fromPixels(r),b=p.g((function(){return f.transpose([0,1,2]).expandDims()})),a.executeAsync(b).then((function(e){var n,a,i,r=e[4].arraySync(),d=e[6].dataSync(),b=I(d,.5,r,s,o,l,u),g=Array(5).fill(null),j=Array(5).fill(null);if(b.length>0){for(n=0,a=b.length,i=5,h.clearRect(0,0,je,ge);n<a;){var m=b[n].bbox[0],v=b[n].bbox[1],x=b[n].bbox[2],O=b[n].bbox[3];h.strokeStyle="#00FFFF",h.lineWidth=2,h.strokeRect(m,v,x,O),n<i&&(g[n]=b[n].score),n++}var w=b.map((function(e,t){return e.cropBox})),y=b.map((function(e,t){return e.boxInd})),C=p.g((function(){var e=f.tile([y.length,1,1]).reshape([-1,f.shape[0],f.shape[1],3]);return p.d.cropAndResize(e,w,y,[224,224],"bilinear")})),k=p.g((function(){return c.execute(C).arraySync()}));n=0,a=t.current.length,i=b.length;for(var S=C.arraySync();n<a;){if(n<i){var P=t.current[n];p.a.toPixels(S[n],P),j[n]=k[n][0]}else{t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height)}n++}C.dispose()}else for(h.clearRect(0,0,je,ge),n=0,a=t.current.length;n<a;){t.current[n].getContext("2d").clearRect(0,0,t.current[n].width,t.current[n].height),n++}return M(g),_(j),e})).then((function(e){for(var t=0,n=e.length;t<n;)p.b(e[t]),t++})).finally((function(){p.b(f),p.b(b)}));case 34:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return Object(a.useEffect)((function(){p.f().then((function(e){p.c(),console.log("tfjs is ready")})).then(we)}),[]),Object(a.useEffect)((function(){if(null!==L&&null!==Q){if($){var e=setInterval(ye,100,L,Q);return function(){return clearInterval(e)}}console.log("Run on test img"),ye(L,Q)}}),[Q,L,ue,de,$,U]),Object(a.useEffect)((function(){if(!$){var e=new Image;e.src=P,e.onload=function(){X({oriImgHeight:e.naturalHeight,oriImgWidth:e.naturalWidth})}}}),[$]),Object(a.useEffect)((function(){M(Array(5).fill(null)),_(Array(5).fill(null))}),[5]),Object(a.useEffect)((function(){C().then((function(e){oe(e),e.length>0&&ce(e[0])}))}),[$]),Object(k.jsxs)("div",{className:"App",style:w.root,children:[Object(k.jsxs)("div",{style:Object(s.a)(Object(s.a)({},w.webCamParentPanel),{},{flexBasis:"".concat(65,"%")}),children:[Object(k.jsxs)("div",{style:Object(s.a)(Object(s.a)({},w.webCamPanel),{},{flexBasis:"".concat(70,"%")}),children:[$&&Object(k.jsxs)("div",{style:{},children:[Object(k.jsx)(O.a,{audio:!1,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{height:je,width:ge}),id:"img",ref:e,height:je,width:ge,screenshotQuality:1,screenshotFormat:"image/jpeg",videoConstraints:Oe}),Object(k.jsx)("canvas",{id:"myCanvas",height:je,width:ge,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{zIndex:9999,backgroundColor:"transparent"})})]}),!$&&Object(k.jsxs)("div",{style:{},children:[Object(k.jsx)("img",{id:"test_img",src:P,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{height:pe,width:ve}),height:pe,width:ve,alt:""}),Object(k.jsx)("canvas",{id:"test_canvas",height:pe,width:ve,style:Object(s.a)(Object(s.a)({},w.webCamStackItem),{},{zIndex:9999,backgroundColor:"transparent"})})]})]}),Object(k.jsx)("div",{style:Object(s.a)(Object(s.a)({},w.settingPanel),{},{flexBasis:"".concat(30,"%")}),children:Object(k.jsxs)(b.a,{children:[Object(k.jsxs)(h.a,{sx:{m:1,minWidth:220},size:"small",children:[Object(k.jsx)(g.a,{id:"demo-simple-select-autowidth-label",children:"Video Input"}),Object(k.jsx)(m.a,{labelId:"demo-simple-select-autowidth-label",id:"demo-simple-select-autowidth",value:ae.deviceId,onChange:function(e){ce({deviceName:e.target.name,deviceId:e.target.value})},autoWidth:!0,label:"Video Input",children:se.length>0?se.map((function(e,t){return Object(k.jsx)(j.a,{value:e.deviceId,children:e.deviceName},t)})):Object(k.jsx)(j.a,{value:"",children:""})})]}),Object(k.jsx)(f.a,{control:Object(k.jsx)(v.a,{checked:$,onChange:function(e){ee(e.target.checked)},inputProps:{"aria-label":"controlled"}}),label:"Webcam",labelPlacement:"start"})]})})]}),Object(k.jsx)("div",{style:Object(s.a)(Object(s.a)({},w.faceMaskPanel),{},{flexBasis:"".concat(35,"%")}),children:function(){if(null==L||null==Q){var e="Face Detection Model - ".concat(100*i,"%"),n="Mask Classifier Model - ".concat(100*F,"%");return Object(k.jsxs)("div",{children:[Object(k.jsx)("div",{children:"Downloading models...."}),Object(k.jsx)("div",{children:e}),Object(k.jsx)("div",{children:n})]})}return t.current.length<1?Object(k.jsx)("div",{children:"Warming up...."}):t.current.map((function(e,n){var a="",c="",i="";return null!==D[n]&&void 0!==D[n]&&null!==R[n]&&void 0!==R[n]&&(a=R[n]>0?"No Mask":"Mask",c="Face: ".concat(D[n].toFixed(2)),i="Mask: ".concat(R[n].toFixed(2))),Object(k.jsxs)("div",{style:w.faceMaskContainer,children:[Object(k.jsx)("div",{children:a}),Object(k.jsx)("canvas",{ref:function(e){return t.current[n]=e},height:xe,width:xe,style:{height:xe,width:xe}}),Object(k.jsx)("div",{children:c}),Object(k.jsx)("div",{children:i})]},n)}))}()})]})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,422)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),i(e),r(e)}))};r.a.render(Object(k.jsx)(c.a.StrictMode,{children:Object(k.jsx)(F,{})}),document.getElementById("root")),W()}},[[370,1,2]]]);
//# sourceMappingURL=main.658033c2.chunk.js.map